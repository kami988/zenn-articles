---
title: "Raspberry Pi + NVMe SSD で自作する外出先からもアクセス可能なNAS"
emoji: "👋"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["nas","raspberrypi","openmediavault"]
published: false
---

## 安さと小ささ、楽しさを求めて

数百GB分くらいのオンラインストレージが欲しいなと思って色々探していたのですが、ランニングコストが掛かるのがあまり好きじゃないのでNASを導入することにしました。
既製品のNASもたくさんありますが、自作できたらカッコいいなと思いChatGPTに相談したところ「ラズパイ（省電力、小型） + OpenMediaVault（初心者にも優しい無料のNASシステム）」の組み合わせを提案してくれて、ちょうど置物にしてしまっていた悲しいラズパイ5があったので作ってみることにしました。

導入方法はOpenMediaVaultの公式が用意してくれている以下の記事があるので、これを参考にしつつ作った手順を書きます。
特にはまりポイントは無く、わかりやすく少ない手順で導入できるようにしてくれているので、１日あればできちゃうかと思います。

https://wiki.omv-extras.org/doku.php?id=omv7:raspberry_pi_install

## システム構成

今回の構成は以下の通りです。全部を１から買うと2万円ちょっとだと思います。セットで買ったりグレードを下げたりするともう少し抑えられるかもしれません。
本当はSSDを2枚にしてRAID1にもしてみたいですが、しばらくはこの構成で小さく始めてみて問題なければ予算を増やしてリッチにしていこうと思います。
作業PCはMacを使いましたが、Windowsでも大差ないと思います。ラズパイでの作業はリモートログインで行うので、モニタやマウス、キーボード等は不要でした。

NAS本体
- PC: Raspberry Pi 5 4G（公式ファン付き）
- OS: Raspberry Pi OS Lite（64bit, 2024-11-19リリース）
- NASシステム: OpenMediaVault7
- NAS用ストレージ: HIKSEMI SSD 512GB M.2 2280 NVMe PCIe Gen3x4
- SSD 拡張ボード: ELUTENG B0CZ9FH98C
- M.2 ネジ: その辺のM2ネジ（SSDにも拡張ボードにも付属してなかった。。）
- ラズパイ用ケース: Geekworm P579
- OS用microSD: SanDisk UHS-I U1 Class10 64GB
- ACアダプター: Smraza 27W PDアダプター
- LAN ケーブル

作業PC
- PC: M2 Macbook Pro
- OS: macOS Sequoia バージョン15.4
- microSDカードリーダー

## microSD に OS 書き込み

以下のリンクから「Raspberry Pi Imager」をインストールします。
https://www.raspberrypi.com/software/

Raspberry Pi Imagerにて、以下のようにデバイスを指定します
- Raspberry Piデバイス: RASPBERRY PI 5
- OS: RASPBERRY PI OS LITE (64-BIT)
- ストレージ: "作業PCに接続したmicroSDカード"

![](/images/91b57980bcc0db/2025-04-11-imager.png)

`次へ`をクリックし、ダイアログ上の`設定を編集する`をクリックして以下のように「一般」と「サービス」の項目を編集します。編集したら`保存`を押します。
WiFi接続させたい場合はここで設定することが可能です。

- 一般
  - ホスト名: `raspberrypi-nas`
  - ユーザー名: `nas`
  - パスワード: `"お好みの文字列"`
- サービス
  - SSHを有効にするをチェックを入れ、「パスワード認証を使う」を選択

![](/images/91b57980bcc0db/imager-general.png)
![](/images/91b57980bcc0db/imager-ssh.png)

ダイアログに戻ったら`はい`をクリックし、microSDのデータが削除される警告に対しても`はい`をクリックして書き込み開始させます。完了を待つ間にラズパイを組み立てちゃいます。

## ラズパイ組み立て

以下の写真の流れで組み立てていきました。
ケースまで固定すると、ファンやSSDが動かなかったときに面倒なのでSSDの接続までやれば動作テストする方が良いかもです。

まずはラズパイ本体にファンを取り付けます。
![](/images/91b57980bcc0db/PXL_20250411_084354505.MP.jpg)
次にSSD 拡張ボードを取り付けます。底面はケース付属のスペーサーを取り付けます。
![](/images/91b57980bcc0db/PXL_20250411_100455120.MP.jpg)
![](/images/91b57980bcc0db/PXL_20250411_085421009.MP.jpg)
次にSSDをボードに取り付けます。
![](/images/91b57980bcc0db/PXL_20250411_095301348.MP.jpg)
最後にケースを取り付けてmicroSDを挿したらできあがりヽ(´▽｀)/
コンパクトでカッコいい感じですが、ファンの排気熱が拡張ボードに直撃するのと、microSDがケースから少しはみ出ているのがちょっと心配ですね
![](/images/91b57980bcc0db/PXL_20250411_101402708.MP.jpg)
![](/images/91b57980bcc0db/PXL_20250411_100949786.MP.jpg)
![](/images/91b57980bcc0db/PXL_20250411_100852492.MP.jpg)
![](/images/91b57980bcc0db/PXL_20250411_103321231.MP.jpg)

## ラズパイにログイン & openmediavaultをインストール

ラズパイの電源を入れ、1分ほど待ってから、作業PCにて以下のコマンドを打ってラズパイにSSHログインします。
初ログインする際は接続するか質問されるので`yes`と答え、Raspberry Pi Imagerで設定したパスワードを入力したらログイン完了です。

```sh
ssh nas@raspberrypi-nas.local
```

ログインしたら、以下のコマンドを順番に打ってOSの更新とopenmediavaultのプリインストールを行います。

```sh
sudo apt-get update
```
```sh
sudo apt-get upgrade -y
```
```sh
wget -O - https://github.com/OpenMediaVault-Plugin-Developers/installScript/raw/master/preinstall | sudo bash
```

３つ目のログの最後に`Please reboot the system now.`と書かれているので、以下のコマンドでラズパイを再起動します。

```sh
sudo reboot
```

少し待った後、再度上のsshコマンドでラズパイにログインしてから以下のコマンドを実行してopenmediavaultをインストールします。

:::message alert
公式によると、インストールコマンドの実行中はでターミナルウィンドウを非アクディブにする（他のウィンドウをクリックした状態にする）必要があるみたいです。また、インストール完了後は自動でラズパイを再起動します。
:::

```sh
wget -O - https://github.com/OpenMediaVault-Plugin-Developers/installScript/raw/master/install | sudo bash
```

筆者の環境ではインストールコマンドの最終行は以下の文が表示されていました。

```sh
["日時"] [omvinstall] IP address may change and you could lose connection if running this script via ssh.
```

## まずはローカルで動くところまで設定

作業PCからChromeなどのブラウザにて以下を入力してアクセスすると、下の画像のようなWebページが開かれます。

```sh
http://raspberrypi-nas.local
```

![](/images/91b57980bcc0db/omv7-login.png)

初期のユーザー名とパスワードは以下になっているので、それぞれ入力してログインします。以下の画像のように表示されればログイン成功のようです。

- ユーザー名: `admin`
- パスワード: `openmediavault`

![](/images/91b57980bcc0db/omv7-home.png)

このことから、どうやらOpenMediaVaultはhttpサーバーとしても動作していて、同じローカルネットワーク上の端末からブラウザでNASの設定を行えるようになっているようです。しかもこのWebページは無料とは思えないほどリッチで、スマホでも操作しやすいようにレスポンシブになっています。また、CPUやメモリのモニタリング機能もあるようです。すごすぎ

### パスワード変更
画面右上のユーザーアイコンからログイン時のパスワードを変更しておきます。

![](/images/91b57980bcc0db/change-pass.png)

### NAS用SSDのデータ削除
サイドバーの「Storage > Disks」から、NASのために用意したSSDをクリックしてテーブル上部の消しゴムマーク「Wipe」をクリックしてデータを削除します。

![](/images/91b57980bcc0db/omv7-wipe.png)
Yesをクリック
![](/images/91b57980bcc0db/omv7-wipe2.png)
今回はQuickをクリック
![](/images/91b57980bcc0db/omv7-wipe3.png)
Closeをクリックして終了
![](/images/91b57980bcc0db/omv7-wipe4.png)

### ストレージをフォーマット & マウント
サイドバーの「Storage > FileSystems」から、以下の画像の流れで共有用のフォルダを作成します。
テーブル上部の+ボタンをクリックし、「EXT4」を選択
![](/images/91b57980bcc0db/omv7-shared-folder2.png)
Devicesの項目で先ほどデータ削除したSSDを選択し、Saveをクリック
![](/images/91b57980bcc0db/omv7-shared-folder3.png)
Closeをクリックしてダイアログを閉じる
![](/images/91b57980bcc0db/omv7-shared-folder4.png)
FileSystemの項目でまた先ほどデータ削除したSSDを選択し、Saveをクリックし、黄色のバナー右上のApplyをクリックして完了
![](/images/91b57980bcc0db/omv7-shared-folder5.png)

### 共有用フォルダ作成
サイドバーの「Storage > Shared Folders」から、以下の画像の流れで共有用のフォルダを作成します。
テーブル上部の+ボタンをクリック
![](/images/91b57980bcc0db/shared-folder7.png)
各項目を以下のように設定してSaveをクリックし、黄色のバナー右上のApplyをクリックして完了
- Name: 適当なフォルダ名
- FileSystemに先ほどマウントしたSSD
- Permissions: Everyone: read/write
![](/images/91b57980bcc0db/shared-folder8.png)

### 共有設定
サイドバーの「SMB/CIFD > Settings」から、Enabledにチェックを入れて下のSaveをクリックし、黄色のバナー右上のApplyをクリックして有効化完了です。
![](/images/91b57980bcc0db/cifs1.png)

続いてサイドバーの「SMB/CIFD > Shares」から、以下の項目を設定し、下のSaveをクリックし、黄色のバナー右上のApplyをクリックして完了
- Shared folder: 共有したフォルダを選択
- Public: Guests allowed
- Inherit permissions: ☑️
- Store DOS attributes: ☑️
![](/images/91b57980bcc0db/cifs3.png)


作業PCのフォルダ閲覧アプリにてネットワークを選択し、「raspberrypi-nas - SMB/CIFS」をクリックすると共有フォルダが出てきました！🎉
これで同じローカルネットワーク上の端末からは共有フォルダに好きなようにファイルやフォルダを読み書きできるようになりました。

## 外出先からもアクセスできるようにする
